# ============================================================================
# Full Test Configuration - All Satellites Can Communicate
# Each satellite can send to all other 8 satellites
# ============================================================================

[General]
network = RingFdlOBS
sim-time-limit = 3.5s

# Output Control
cmdenv-express-mode = true
cmdenv-autoflush = true
cmdenv-output-file = results/simulation_log.txt
**.vector-recording = false
**.scalar-recording = false

# Disable Network Configurator
**.networkLayer.configurator.networkConfiguratorModule = ""

# ============ Network Parameters - 10 Node Topology ============
# Set all lambdas to 1 for simplicity
**.lambdasEdge1 = 1
**.lambdasEdge2 = 1
**.lambdasEdge3 = 1
**.lambdasEdge4 = 1
**.lambdasEdge5 = 1
**.lambdasEdge6 = 1
**.lambdasEdge7 = 1
**.lambdasEdge8 = 1
**.lambdasEdge9 = 1
**.lambdasEdge10 = 1

# ISL Lambdas - Row 1 Horizontal
**.lambdasCore1to2 = 3  # Increased from 1 to 3 to reduce contention on sat2->sat1 link
**.lambdasCore2to3 = 1
# ISL Lambdas - Row 2 Horizontal
**.lambdasCore4to5 = 1
**.lambdasCore5to6 = 1
**.lambdasCore6to7 = 1
# ISL Lambdas - Row 3 Horizontal
**.lambdasCore8to9 = 1
**.lambdasCore9to10 = 1
# ISL Lambdas - Vertical
**.lambdasCore1to4 = 1
**.lambdasCore2to5 = 1
**.lambdasCore3to6 = 1
**.lambdasCore5to8 = 1
**.lambdasCore6to9 = 1
**.lambdasCore7to10 = 1

# ============ Core Node Configuration ============
**.sat*.coreSwitch.inputColours = ""
**.sat*.coreSwitch.outputColours = ""
**.sat*.coreSwitch.**.guardTime = 0.000000001s
**.sat*.coreSwitch.**.BCPProcessingDelay = 0s
**.sat*.coreSwitch.**.dataRate = 10Gbps
**.sat*.coreSwitch.**.reportFile = ""

# Core Node Port Configuration (Port0=Edge, remaining=ISL neighbors)
# Sat1: Edge + Sat2(right) + Sat4(down) = 3 ports
**.sat1.coreSwitch.lambdasPerInPort = "1 3 1"  # Port1=Sat2 now has 3 lambdas
**.sat1.coreSwitch.lambdasPerOutPort = "1 3 1"  # Port1=Sat2 now has 3 lambdas
# Sat2: Edge + Sat1 + Sat3 + Sat5 = 4 ports
**.sat2.coreSwitch.lambdasPerInPort = "1 3 1 1"  # Port1=Sat1 now has 3 lambdas
**.sat2.coreSwitch.lambdasPerOutPort = "1 3 1 1"  # Port1=Sat1 now has 3 lambdas
# Sat3: Edge + Sat2 + Sat6 = 3 ports
**.sat3.coreSwitch.lambdasPerInPort = "1 1 1"
**.sat3.coreSwitch.lambdasPerOutPort = "1 1 1"
# Sat4: Edge + Sat1 + Sat5 = 3 ports
**.sat4.coreSwitch.lambdasPerInPort = "1 1 1"
**.sat4.coreSwitch.lambdasPerOutPort = "1 1 1"
# Sat5: Edge + Sat2 + Sat4 + Sat6 + Sat8 = 5 ports
**.sat5.coreSwitch.lambdasPerInPort = "1 1 1 1 1"
**.sat5.coreSwitch.lambdasPerOutPort = "1 1 1 1 1"
# Sat6: Edge + Sat3 + Sat5 + Sat7 + Sat9 = 5 ports
**.sat6.coreSwitch.lambdasPerInPort = "1 1 1 1 1"
**.sat6.coreSwitch.lambdasPerOutPort = "1 1 1 1 1"
# Sat7: Edge + Sat6 + Sat10 = 3 ports
**.sat7.coreSwitch.lambdasPerInPort = "1 1 1"
**.sat7.coreSwitch.lambdasPerOutPort = "1 1 1"
# Sat8: Edge + Sat5 + Sat9 = 3 ports
**.sat8.coreSwitch.lambdasPerInPort = "1 1 1"
**.sat8.coreSwitch.lambdasPerOutPort = "1 1 1"
# Sat9: Edge + Sat6 + Sat8 + Sat10 = 4 ports
**.sat9.coreSwitch.lambdasPerInPort = "1 1 1 1"
**.sat9.coreSwitch.lambdasPerOutPort = "1 1 1 1"
# Sat10: Edge + Sat7 + Sat9 = 3 ports
**.sat10.coreSwitch.lambdasPerInPort = "1 1 1"
**.sat10.coreSwitch.lambdasPerOutPort = "1 1 1"

# OE/EO Conversion
**.OEConversionDelay = 0s
**.EOConversionDelay = 0s

# ============ Edge Node Configuration ============
**.sat*.edgeRouter.outColours = ""
**.sat*.edgeRouter.**.dispatcherRules = "DispatcherRules.dat"
**.sat*.edgeRouter.**.numFileBurstifiers = 0
**.sat*.edgeRouter.**.numPacketBurstifiers = 8    # Strictly 8 physical queues for all 10 destinations

# Burst Assembly Parameters
# Realistic OBS deployment: small timeout for low latency
**.packetBurstifier[*].timeout = 0.002s       # 2ms timeout
**.packetBurstifier[*].maxSize = 125000000B
**.packetBurstifier[*].numPackets = 1         # Send immediately (1 packet per burst)
**.packetBurstifier[*].minOffset = 0.001s
**.packetBurstifier[*].maxOffset = 0.002s
**.packetBurstifier[*].minSizeWithPadding = 50B
**.packetBurstifier[*].overflowLastPacket = true
**.packetBurstifier[*].cteHeader = 8B
**.packetBurstifier[*].varHeader = 1B

# No static destLabel needed anymore - handled dynamically by Dispatcher
**.destLabel = -1

# Sender Configuration
**.sender.BCPSize = 16B
**.sender.guardTime = 0.000000001s
**.sender.dataRate = 10Gbps
**.sender.maxSchedBurstSize = 0
**.sender.maxSchedBurstElems = 0
**.sender.testing = false

# ============ Common Host/IP Configuration ============
# IP Configuration
**.ip.procDelay = 0
**.arp.cacheTimeout = 100s
**.eth[*].mac.txrate = 10Gbps
**.ppp[*].queue.frameCapacity = 100000
**.eth[*].queue.frameCapacity = 100000


# ============================================================================
# Config ICMPTest - ICMP Ping Test (Sat1 -> Sat5 and Sat1 -> Sat10)
# ============================================================================
[Config ICMPTest]
description = "ICMP Ping test: Sat1(10.0.1.10)->Sat5, Sat1(10.0.1.11)->Sat10"

# Host Application Configuration
**.sat*.host.numTcpApps = 0
**.sat*.host.numUdpApps = 0
**.sat1.host.numPingApps = 2   # Normal state: 2 flows
**.sat5.host.numPingApps = 1
**.sat10.host.numPingApps = 1

# Sat1 terminal 1 pings Sat5
**.sat1.host.pingApp[0].destAddr = "sat5.host"
**.sat1.host.pingApp[0].startTime = 0.1s
**.sat1.host.pingApp[0].sendInterval = 1s
**.sat1.host.pingApp[0].count = 10
**.sat1.host.pingApp[0].printPing = true

# Sat1 terminal 2 pings Sat10
**.sat1.host.pingApp[1].destAddr = "sat10.host"
**.sat1.host.pingApp[1].startTime = 0.1s
**.sat1.host.pingApp[1].sendInterval = 1s
**.sat1.host.pingApp[1].count = 10
**.sat1.host.pingApp[1].printPing = true

# Sat5 pings back (optional bidirectional test)
**.sat5.host.pingApp[0].destAddr = ""

# Sat10 pings back (optional bidirectional test)
**.sat10.host.pingApp[0].destAddr = ""


# Config UDPTest - UDP Communication Test (Sat1 -> Sat5 and Sat10)
# ============================================================================
[Config UDPTest]
description = "UDP communication test: Sat1 to Sat5 and Sat10"

# Host Application Configuration
**.sat*.host.numTcpApps = 0
**.sat*.host.numUdpApps = 1
**.sat*.host.numPingApps = 0

# Sat1 sends UDP packets to Sat5 (UDPBasicApp)
**.sat1.host.udpApp[0].typename = "UDPBasicApp"
**.sat1.host.udpApp[0].destAddresses = "sat5.host sat10.host"
**.sat1.host.udpApp[0].destPort = 5000
**.sat1.host.udpApp[0].localPort = 5001
**.sat1.host.udpApp[0].messageLength = 1000B
**.sat1.host.udpApp[0].sendInterval = 0.1s
**.sat1.host.udpApp[0].startTime = 0.1s
**.sat1.host.udpApp[0].stopTime = 9s

# Sat5 receives UDP packets (UDPSink)
**.sat5.host.udpApp[0].typename = "UDPSink"
**.sat5.host.udpApp[0].localPort = 5000

# Sat10 receives UDP packets (UDPSink)
**.sat10.host.udpApp[0].typename = "UDPSink"
**.sat10.host.udpApp[0].localPort = 5000

# Other satellites - UDPSink (idle, just listening)
**.sat2.host.udpApp[0].typename = "UDPSink"
**.sat2.host.udpApp[0].localPort = 5000
**.sat3.host.udpApp[0].typename = "UDPSink"
**.sat3.host.udpApp[0].localPort = 5000
**.sat4.host.udpApp[0].typename = "UDPSink"
**.sat4.host.udpApp[0].localPort = 5000
**.sat6.host.udpApp[0].typename = "UDPSink"
**.sat6.host.udpApp[0].localPort = 5000
**.sat7.host.udpApp[0].typename = "UDPSink"
**.sat7.host.udpApp[0].localPort = 5000
**.sat8.host.udpApp[0].typename = "UDPSink"
**.sat8.host.udpApp[0].localPort = 5000
**.sat9.host.udpApp[0].typename = "UDPSink"
**.sat9.host.udpApp[0].localPort = 5000


# ============================================================================
# Config TCPTest - TCP Communication Test (Sat1 <-> Sat5)
# ============================================================================
[Config TCPTest]
description = "TCP communication test between Sat1 and Sat5"

# Host Application Configuration
**.sat*.host.numTcpApps = 1
**.sat*.host.numUdpApps = 0
**.sat*.host.numPingApps = 0

# Sat1 as TCP Client - connects to Sat5
**.sat1.host.tcpApp[0].typename = "TCPBasicClientApp"
**.sat1.host.tcpApp[0].connectAddress = "sat5.host"
**.sat1.host.tcpApp[0].connectPort = 1000
**.sat1.host.tcpApp[0].startTime = 0.1s
**.sat1.host.tcpApp[0].numRequestsPerSession = 10
**.sat1.host.tcpApp[0].requestLength = 1000B
**.sat1.host.tcpApp[0].replyLength = 1000B
**.sat1.host.tcpApp[0].thinkTime = 0.5s
**.sat1.host.tcpApp[0].idleInterval = 3s

# Sat5 as TCP Server - echo service
**.sat5.host.tcpApp[0].typename = "TCPEchoApp"
**.sat5.host.tcpApp[0].localPort = 1000
**.sat5.host.tcpApp[0].echoFactor = 1.0
**.sat5.host.tcpApp[0].echoDelay = 0s

# Other satellites - TCP server (idle, just listening)
**.sat2.host.tcpApp[0].typename = "TCPEchoApp"
**.sat2.host.tcpApp[0].localPort = 1000
**.sat3.host.tcpApp[0].typename = "TCPEchoApp"
**.sat3.host.tcpApp[0].localPort = 1000
**.sat4.host.tcpApp[0].typename = "TCPEchoApp"
**.sat4.host.tcpApp[0].localPort = 1000
**.sat6.host.tcpApp[0].typename = "TCPEchoApp"
**.sat6.host.tcpApp[0].localPort = 1000
**.sat7.host.tcpApp[0].typename = "TCPEchoApp"
**.sat7.host.tcpApp[0].localPort = 1000
**.sat8.host.tcpApp[0].typename = "TCPEchoApp"
**.sat8.host.tcpApp[0].localPort = 1000
**.sat9.host.tcpApp[0].typename = "TCPEchoApp"
**.sat9.host.tcpApp[0].localPort = 1000
**.sat10.host.tcpApp[0].typename = "TCPEchoApp"
**.sat10.host.tcpApp[0].localPort = 1000


# =========================================================================
#  Config LRUPreemptionTest - Testing Resource Exhaustion (8 queues vs 10 dests)
# =========================================================================
[Config LRUPreemptionTest]
description = "Stress test for LRU-based queue preemption and adaptive flush"

# Force queues to stay BUSY to trigger preemption
**.packetBurstifier[*].timeout = 0.01s
**.packetBurstifier[*].numPackets = 1000
**.packetBurstifier[*].minSizeWithPadding = 500B

# Start 10 simultaneous flows from Sat1 to all nodes
**.sat1.host.numPingApps = 10
# Stagger start times (1ms interval) to trigger preemption safely
**.sat1.host.pingApp[0].startTime = 0.100s
**.sat1.host.pingApp[1].startTime = 0.100s
**.sat1.host.pingApp[2].startTime = 0.102s
**.sat1.host.pingApp[3].startTime = 0.100s
**.sat1.host.pingApp[4].startTime = 0.104s
**.sat1.host.pingApp[5].startTime = 0.105s
**.sat1.host.pingApp[6].startTime = 0.106s
**.sat1.host.pingApp[7].startTime = 0.107s
**.sat1.host.pingApp[8].startTime = 0.108s
**.sat1.host.pingApp[9].startTime = 0.109s
**.sat1.host.pingApp[*].sendInterval = 0.2s
**.sat1.host.pingApp[*].count = 15
**.sat1.host.pingApp[*].printPing = true

**.sat1.host.pingApp[0].destAddr = "sat5.host"
**.sat1.host.pingApp[1].destAddr = "sat2.host"
**.sat1.host.pingApp[2].destAddr = "sat3.host"
**.sat1.host.pingApp[3].destAddr = "sat4.host"
**.sat1.host.pingApp[4].destAddr = "sat5.host"
**.sat1.host.pingApp[5].destAddr = "sat6.host"
**.sat1.host.pingApp[6].destAddr = "sat7.host"
**.sat1.host.pingApp[7].destAddr = "sat8.host"
**.sat1.host.pingApp[8].destAddr = "sat9.host"   # Should trigger preemption
**.sat1.host.pingApp[9].destAddr = "sat10.host"  # Should trigger preemption

# Ensure all OTHER target nodes are ready to respond (DO NOT OVERRIDE SAT1)
**.sat*.host.numPingApps = 1
**.sat1.host.numPingApps = 10

# ============ Detailed Logging Configuration ============
# Enable detailed event logging for debugging packet loss
# Note: cmdenv-output-file is set in [General] section

# Disable express mode to see all events (override General setting)
cmdenv-express-mode = false

# Enable event banners for detailed tracing
cmdenv-event-banners = true

# Log output for key modules (CoreControl, Dispatcher, Burstifier, Disassembler)
# Sat1 - Source node
**.sat1.coreSwitch.ControlUnit.ControlLogic.cmdenv-ev-output = true
**.sat1.edgeRouter.obs.assembler.dispatcher.cmdenv-ev-output = true
**.sat1.edgeRouter.obs.assembler.packetBurstifier[*].cmdenv-ev-output = true
**.sat1.edgeRouter.obs.assembler.sender.cmdenv-ev-output = true
**.sat1.edgeRouter.obs.disassembler.cmdenv-ev-output = true

# Sat2 - Return path node
**.sat2.coreSwitch.ControlUnit.ControlLogic.cmdenv-ev-output = true
**.sat2.edgeRouter.obs.disassembler.cmdenv-ev-output = true

# Sat5 - Return path node
**.sat5.coreSwitch.ControlUnit.ControlLogic.cmdenv-ev-output = true
**.sat5.edgeRouter.obs.disassembler.cmdenv-ev-output = true

# Sat6 - Return path node
**.sat6.coreSwitch.ControlUnit.ControlLogic.cmdenv-ev-output = true
**.sat6.edgeRouter.obs.disassembler.cmdenv-ev-output = true

# Sat7 - Return path node (between Sat10 and Sat6)
**.sat7.coreSwitch.ControlUnit.ControlLogic.cmdenv-ev-output = true
**.sat7.edgeRouter.obs.assembler.dispatcher.cmdenv-ev-output = true
**.sat7.edgeRouter.obs.assembler.packetBurstifier[*].cmdenv-ev-output = true
**.sat7.edgeRouter.obs.disassembler.cmdenv-ev-output = true

# Sat10 - Destination node (generates ping replies)
**.sat10.coreSwitch.ControlUnit.ControlLogic.cmdenv-ev-output = true
**.sat10.edgeRouter.obs.assembler.dispatcher.cmdenv-ev-output = true
**.sat10.edgeRouter.obs.assembler.packetBurstifier[*].cmdenv-ev-output = true
**.sat10.edgeRouter.obs.assembler.sender.cmdenv-ev-output = true
**.sat10.edgeRouter.obs.disassembler.cmdenv-ev-output = true

# Reduce simulation time for faster debugging
sim-time-limit = 3.5s
